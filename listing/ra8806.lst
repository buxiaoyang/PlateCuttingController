C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE RA8806
OBJECT MODULE PLACED IN .\output\ra8806.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE source\ra8806.c LARGE BROWSE INCDIR(.\include\) DEBUG OBJECTEXTEND PRINT(.\
                    -listing\ra8806.lst) OBJECT(.\output\ra8806.obj)

line level    source

   1          /***************************************************************************/
   2          // 程序：清洗设备控制器
   3          // 模块：液晶驱动
   4          // 文件：ra8806.c
   5          // 作者：卜晓D
   6          // 版本：V0.02
   7          // 日期：2013年11月8日
   8          // 功能：液晶驱动
   9          // 芯片：STC12C5A60S2
  10          // 编译：Keil uVision3 V3.90
  11          /***************************************************************************/
  12          
  13          #include <reg52.h>
  14          #include <basefunc.h>
  15          #include <fonts.h>
  16          #include <ra8806.h> 
  17          #include <parameter.h>
  18          
  19          /***************************************************************************/
  20          // 液晶引脚定义 
  21          /***************************************************************************/
  22          #define lcd_data P0
  23          sbit REST       = P2^7;   // REST就是接口中的RST
  24          sbit BUSY       = P2^6;   //BUSY就是接口中的BUSY
  25          sbit CS         = P2^5;   // CS就是接口中的CS1
  26          sbit RD0        = P2^4;  // RD0就是接口中的RD
  27          sbit WR0        = P2^3;  // WR0就是接口中的WR
  28          sbit CD         = P2^2;   // CD 就是接口中的RS
  29          
  30          
  31          
  32          
  33          
  34          
  35          /***************************************************************************/
  36          // 液晶写入命令函数
  37          // 参数：命令
  38          // 返回值：无   
  39          /***************************************************************************/
  40          void LCD_CmdWrite(uchar cmd)
  41          {
  42   1              CS=0;
  43   1              RD0 = 1;
  44   1              CD = 1;         
  45   1              WR0 = 0;
  46   1              lcd_data = cmd;
  47   1              //delay_us(2); 
  48   1              WR0 = 0;
  49   1              WR0 = 1;
  50   1              CS = 1;
  51   1      }
  52          
  53          /***************************************************************************/
  54          // 液晶写入数据函数
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 2   

  55          // 参数：数据
  56          // 返回值：无   
  57          /***************************************************************************/
  58          void LCD_DataWrite(uchar wdata)
  59          {
  60   1              while(!BUSY);
  61   1              CS=0;
  62   1              RD0 = 1;
  63   1              CD = 0;         
  64   1              lcd_data = wdata; 
  65   1              WR0 = 0;
  66   1              //delay_us(10); 
  67   1              WR0 = 1;
  68   1              CS = 1;
  69   1      }
  70          
  71          /***************************************************************************/
  72          // 液晶读取命令函数
  73          // 参数：地址
  74          // 返回值：命令
  75          /***************************************************************************/
  76          uchar LCD_CmdRead(uchar Addr)
  77          {  
  78   1              uchar Data;  
  79   1              CS=0;
  80   1              CD=1;
  81   1              RD0=1;
  82   1              lcd_data=Addr;
  83   1              WR0=0;
  84   1              WR0=1;
  85   1              lcd_data=0XFF;
  86   1              CD=0;
  87   1              WR0=1;
  88   1              RD0=1;
  89   1              RD0=0;
  90   1              Data=lcd_data;
  91   1              return Data;
  92   1      }
  93          
  94          /***************************************************************************/
  95          // 液晶读取数据函数
  96          // 参数：无
  97          // 返回值：数据
  98          /***************************************************************************/
  99          /*
 100          uchar LCD_DataRead()
 101          {
 102                  uchar Data;
 103                  lcd_data = 0x00;
 104                  WR0 = 1;
 105                  CS = 0;
 106                  CD  = 0;
 107                  RD0 = 0;
 108                  Data = lcd_data;
 109                  RD0 = 1;        
 110                  CS = 1;                 
 111                  //CD = 1;
 112                  lcd_data = 0xff;
 113                  return Data;
 114          }
 115          */
 116          
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 3   

 117          /***************************************************************************/
 118          // 液晶初始化函数
 119          // 参数：无
 120          // 返回值：无
 121          /***************************************************************************/
 122          void lcd_inital()
 123          { 
 124   1              REST = 0;
 125   1              delay_ms(50);
 126   1              REST = 1;
 127   1              delay_ms(50);
 128   1              LCD_CmdWrite(WLCR);             //[00H] , Default --> 0x00
 129   1              LCD_DataWrite(0x04);
 130   1              
 131   1              LCD_CmdWrite(MISC);             //[01H] , Default --> 0x00
 132   1              LCD_DataWrite(0x08);
 133   1              
 134   1              LCD_CmdWrite(ADSR);             //[03H] , Default --> 0x00 
 135   1              LCD_DataWrite(0x00);
 136   1              
 137   1              LCD_CmdWrite(INTR);             //[0FH] , Default --> 0x00
 138   1              LCD_DataWrite(0x00);
 139   1              
 140   1              LCD_CmdWrite(WCCR);             //[10H] , Default --> 0x00
 141   1              LCD_DataWrite(0x00);
 142   1              
 143   1              LCD_CmdWrite(CHWI);             //[11H] , Default --> 0x00
 144   1              LCD_DataWrite(0x00);
 145   1              
 146   1              LCD_CmdWrite(MAMR);             //[12H] , Default --> 0x11 
 147   1              LCD_DataWrite(0x11);
 148   1              
 149   1              LCD_CmdWrite(AWRR);             //[20H] , Default --> 0x27
 150   1              LCD_DataWrite(39);
 151   1              
 152   1              LCD_CmdWrite(DWWR);             //[21H] , Default --> 0x27
 153   1              LCD_DataWrite(39);
 154   1              
 155   1              LCD_CmdWrite(AWBR);             //[30H] , Default --> 0xEF      
 156   1              LCD_DataWrite(239);
 157   1              
 158   1              LCD_CmdWrite(DWHR);             //[31H] , Default --> 0xEF
 159   1              LCD_DataWrite(239);
 160   1              
 161   1              LCD_CmdWrite(AWLR);             //[40H] , Default --> 0x00
 162   1              LCD_DataWrite(0x00);
 163   1              
 164   1              LCD_CmdWrite(AWTR);             //[50H] , Default --> 0x00
 165   1              LCD_DataWrite(0x00);
 166   1              
 167   1              LCD_CmdWrite(CURX);             //[60H] , Default --> 0x00 
 168   1              LCD_DataWrite(0x00);
 169   1              
 170   1              LCD_CmdWrite(BGSG);             //[61H] , Default --> 0x00
 171   1              LCD_DataWrite(0x00);
 172   1              
 173   1              LCD_CmdWrite(EDSG);             //[62H] , Default --> 0x00
 174   1              LCD_DataWrite(0x00);
 175   1              
 176   1              LCD_CmdWrite(CURY);             //[70H] , Default --> 0x00
 177   1              LCD_DataWrite(0x00);
 178   1              
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 4   

 179   1              LCD_CmdWrite(BGCM);             //[71H] , Default --> 0x00
 180   1              LCD_DataWrite(0x00);
 181   1              
 182   1              LCD_CmdWrite(EDCM);             //[72H] , Default --> 0x00
 183   1              LCD_DataWrite(0x00);
 184   1              
 185   1              LCD_CmdWrite(BTMR);             //[80H] , Default --> 0x00
 186   1              LCD_DataWrite(0x00);
 187   1              
 188   1              LCD_CmdWrite(ITCR);             //[90H] , Default --> 0x00    需要调整
 189   1              LCD_DataWrite(0x80);
 190   1              
 191   1              LCD_CmdWrite(PNTR);             //[E0H] , Default --> 0x00
 192   1              LCD_DataWrite(0x00);
 193   1              
 194   1              LCD_CmdWrite(FNCR);             //[F0H] , Default --> 0x00
 195   1              LCD_DataWrite(0x00);
 196   1              
 197   1              LCD_CmdWrite(FVHT);             //[F1H] , Default --> 0x00
 198   1              LCD_DataWrite(0x00);
 199   1      }
 200          
 201          /***************************************************************************/
 202          // 液晶X,Y坐标定位
 203          // 参数：x坐标  y坐标
 204          // 返回值：无
 205          /***************************************************************************/
 206          void LCD_GotoXY(uchar xx,uchar yy)
 207          {
 208   1              LCD_CmdWrite(CURX); 
 209   1              LCD_DataWrite(xx);
 210   1              LCD_CmdWrite(CURY);  
 211   1              LCD_DataWrite(yy);
 212   1      }
 213          
 214          /***************************************************************************/
 215          // 液晶绘图模式
 216          // 参数：无
 217          // 返回值：无
 218          /***************************************************************************/
 219          void LCD_Graphic(void)
 220          {
 221   1              uchar temp;
 222   1              temp=LCD_CmdRead(WLCR);
 223   1              temp &=0xf7;
 224   1              LCD_CmdWrite(WLCR);
 225   1              LCD_DataWrite(temp); 
 226   1      }
 227          
 228          /***************************************************************************/
 229          // 液晶文字模式
 230          // 参数：无
 231          // 返回值：无
 232          /***************************************************************************/
 233          void LCD_Text(void)
 234          {
 235   1              uchar temp;
 236   1              temp=LCD_CmdRead(WLCR);
 237   1              temp |=0x08;
 238   1              LCD_CmdWrite(WLCR);
 239   1              LCD_DataWrite(temp); 
 240   1      }
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 5   

 241          
 242          /***************************************************************************/
 243          // 液晶DDRAM1 显示
 244          // 参数：无
 245          // 返回值：无
 246          /***************************************************************************/
 247          void Only_Show_Page1(void)
 248          {
 249   1              uchar temp;
 250   1              temp=LCD_CmdRead(MAMR);
 251   1              temp &=0x9f;
 252   1              temp |=0x10;
 253   1              LCD_CmdWrite(MAMR);
 254   1              LCD_DataWrite(temp); 
 255   1      }
 256          
 257          /***************************************************************************/
 258          // 液晶DDRAM2 显示
 259          // 参数：无
 260          // 返回值：无
 261          /***************************************************************************/
 262          /*
 263          void Only_Show_Page2(void)
 264          {
 265                  uchar temp;
 266                  temp=LCD_CmdRead(MAMR);
 267                  temp &=0xaf;
 268                  temp |=0x20;
 269                  LCD_CmdWrite(MAMR);
 270                  LCD_DataWrite(temp); 
 271          }
 272          */
 273          
 274          /***************************************************************************/
 275          // 液晶DDRAM1和DDRAM2 双图层显示
 276          // 参数：无
 277          // 返回值：无
 278          /***************************************************************************/
 279          void Show_Two_Layer(void)
 280          {
 281   1              uchar temp;     
 282   1              temp=LCD_CmdRead(MAMR);
 283   1              temp &=0xbf;
 284   1              temp |=0x30;
 285   1              LCD_CmdWrite(MAMR);
 286   1              LCD_DataWrite(temp); 
 287   1      }
 288          
 289          /***************************************************************************/
 290          // 液晶DDRAM1和DDRAM2 OR方式显示
 291          // 参数：无
 292          // 返回值：无
 293          /***************************************************************************/
 294          /*
 295          void OR_Two_Layer(void)
 296          {
 297                  uchar temp;     
 298                  temp=LCD_CmdRead(MAMR);
 299                  temp &=0xf3;
 300                  LCD_CmdWrite(MAMR);
 301                  LCD_DataWrite(temp); 
 302          }
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 6   

 303          */
 304          
 305          /***************************************************************************/
 306          // 液晶DDRAM1和DDRAM2 XOR方式显示
 307          // 参数：无
 308          // 返回值：无
 309          /***************************************************************************/
 310          void XOR_Two_Layer(void)
 311          {
 312   1              uchar temp;     
 313   1              temp=LCD_CmdRead(MAMR);
 314   1              temp &=0xf7;
 315   1              temp |=0x04;
 316   1              LCD_CmdWrite(MAMR);
 317   1              LCD_DataWrite(temp); 
 318   1      }
 319          
 320          /***************************************************************************/
 321          // 液晶DDRAM1和DDRAM2 NOR方式显示
 322          // 参数：无
 323          // 返回值：无
 324          /***************************************************************************/
 325          /*
 326          void NOR_Two_Layer(void)
 327          {
 328                  uchar temp;     
 329                  temp=LCD_CmdRead(MAMR);
 330                  temp &=0xfb;
 331                  temp |=0x08;
 332                  LCD_CmdWrite(MAMR);
 333                  LCD_DataWrite(temp); 
 334          }
 335          */
 336          
 337          /***************************************************************************/
 338          // 液晶DDRAM1和DDRAM2 AND方式显示
 339          // 参数：无
 340          // 返回值：无
 341          /***************************************************************************/
 342          /*
 343          void AND_Two_Layer(void)
 344          {
 345                  uchar temp;     
 346                  temp=LCD_CmdRead(MAMR);
 347                  temp |=0x0c;
 348                  LCD_CmdWrite(MAMR);
 349                  LCD_DataWrite(temp); 
 350          }
 351          */
 352          
 353          /***************************************************************************/
 354          // 液晶存取DDRAM1
 355          // 参数：无
 356          // 返回值：无
 357          /***************************************************************************/
 358          void Access_Page1(void)
 359          {
 360   1              uchar temp;     
 361   1              temp=LCD_CmdRead(MAMR);
 362   1              temp &=0xfd;
 363   1              temp |=0x01;
 364   1              LCD_CmdWrite(MAMR);
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 7   

 365   1              LCD_DataWrite(temp); 
 366   1      }
 367          
 368          /***************************************************************************/
 369          // 存取DDRAM2
 370          // 参数：无
 371          // 返回值：无
 372          /***************************************************************************/
 373          void Access_Page2(void)
 374          {
 375   1              uchar temp;     
 376   1              temp=LCD_CmdRead(MAMR);
 377   1              temp &=0xfe;
 378   1              temp |=0x02;
 379   1              LCD_CmdWrite(MAMR);
 380   1              LCD_DataWrite(temp); 
 381   1      }
 382          
 383          /***************************************************************************/
 384          // 液晶清屏
 385          // 参数：无
 386          // 返回值：无
 387          /***************************************************************************/
 388          void clear(void)
 389          { 
 390   1              LCD_Graphic();     //选择绘图模式     
 391   1              LCD_CmdWrite(PNTR);
 392   1              LCD_DataWrite(0x00);
 393   1              LCD_CmdWrite(FNCR);
 394   1              LCD_DataWrite(0xa8);
 395   1              //delay_ms(3);
 396   1      }
 397          
 398          
 399          /***************************************************************************/
 400          // 液晶满屏显示
 401          // 参数：无
 402          // 返回值：无
 403          /***************************************************************************/
 404          /*
 405          void display_all()
 406          {
 407                  LCD_Graphic();
 408                  LCD_CmdWrite(PNTR);
 409                  LCD_DataWrite(0xff);     //全部填0xff
 410                  LCD_CmdWrite(FNCR);
 411                  LCD_DataWrite(0xa8);
 412                  //delay_ms(3);
 413          }
 414          */
 415          
 416          /***************************************************************************/
 417          // 液晶全屏正常显示
 418          // 参数：无
 419          // 返回值：无
 420          /***************************************************************************/
 421          void normal_data(void)
 422          {
 423   1              uchar temp;
 424   1              temp=LCD_CmdRead(WLCR);  //读WLCR寄存器数据
 425   1              temp &=0xfe;
 426   1              LCD_CmdWrite(WLCR);
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 8   

 427   1              LCD_DataWrite(temp);     
 428   1      }
 429          
 430          /***************************************************************************/
 431          // 液晶全屏反白显示
 432          // 参数：无
 433          // 返回值：无
 434          /***************************************************************************/
 435          /*
 436          void reverse_data(void)
 437          {
 438                  uchar temp;
 439                  temp=LCD_CmdRead(WLCR);  //读WLCR寄存器数据
 440                  temp |=0x01;
 441                  LCD_CmdWrite(WLCR);
 442                  LCD_DataWrite(temp);     
 443          }
 444          */
 445          
 446          /***************************************************************************/
 447          // 液晶数据反白输入
 448          // 参数：无
 449          // 返回值：无
 450          /***************************************************************************/
 451          /*
 452          void LCD_Inv(void)
 453          {
 454                  uchar temp;     
 455                  temp=LCD_CmdRead(0x10);
 456                  temp |=0x20;
 457                  LCD_CmdWrite(0x10);
 458                  LCD_DataWrite(temp); 
 459          }
 460          */
 461          
 462          /***************************************************************************/
 463          // 液晶数据正常输入
 464          // 参数：无
 465          // 返回值：无
 466          /***************************************************************************/
 467          void LCD_NoInv(void)
 468          {
 469   1              uchar temp;     
 470   1              temp=LCD_CmdRead(WCCR);
 471   1              temp &=0xdf;
 472   1              LCD_CmdWrite(WCCR);
 473   1              LCD_DataWrite(temp); 
 474   1      }
 475          
 476          /***************************************************************************/
 477          // 液晶字符放大i倍
 478          // 参数：放大倍数1~4
 479          // 返回值：无
 480          /***************************************************************************/
 481          void enlarge(uchar i)
 482          {  
 483   1              switch(i)
 484   1              {
 485   2                      case 0x01:
 486   2                              LCD_CmdWrite(FVHT);
 487   2                              LCD_DataWrite(0x00);  
 488   2                      break;
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 9   

 489   2                      case 0x02:
 490   2                              LCD_CmdWrite(FVHT);
 491   2                              LCD_DataWrite(0x50);  
 492   2                      break;
 493   2                      case 0x03:
 494   2                              LCD_CmdWrite(FVHT);
 495   2                              LCD_DataWrite(0xa0); 
 496   2                      break;
 497   2                      case 0x04:
 498   2                              LCD_CmdWrite(FVHT);
 499   2                              LCD_DataWrite(0xf0); 
 500   2                      break;
 501   2              }
 502   1      }
 503          
 504          /***************************************************************************/
 505          // 液晶画一个表格
 506          // 参数：无
 507          // 返回值：无
 508          /***************************************************************************/
 509          /*
 510          void display_biao(void)
 511          {
 512                  uint n0,n1;
 513                  LCD_Graphic();   //选择绘图模式
 514                  LCD_GotoXY(0x00,0x00);   //设定X,Y坐标位置
 515                  LCD_CmdWrite(MWCR);
 516                  for(n0=0;n0<40;n0++)
 517                  {
 518                          LCD_DataWrite(0xff);
 519                  }
 520                  for(n0=0;n0<31;n0++)            
 521                  {
 522                          for(n1=0;n1<40;n1++)
 523                          {
 524                                  if (n1==0) LCD_DataWrite(0x80);
 525                                  else if (n1==39) LCD_DataWrite(0x01);
 526                                  else LCD_DataWrite(0x00);
 527                          }
 528                  }
 529                  for(n0=0;n0<40;n0++)
 530                  {
 531                          LCD_DataWrite(0xff);
 532                  }
 533                  for(n0=0;n0<(125);n0++)         
 534                  {
 535                          for(n1=0;n1<40;n1++)
 536                          {
 537                                  if (n1==0)          LCD_DataWrite(0x80);
 538                                  else if (n1==39) LCD_DataWrite(0x01);
 539                                  else                LCD_DataWrite(0x00);
 540                          }
 541                  }
 542                  for(n0=0;n0<40;n0++)
 543                  {
 544                          LCD_DataWrite(0xff);
 545                  }
 546          }
 547          */
 548          /***************************************************************************/
 549          // 液晶在指定的坐标处显示字符串
 550          // 参数：x坐标  y坐标  字符串内容
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 10  

 551          // 返回值：无
 552          /***************************************************************************/
 553          void LCD_ShowStr(uchar xxx,uchar yyy,uchar *text)
 554          { 
 555   1              LCD_Text();   //选择文本模式
 556   1              LCD_GotoXY(xxx,yyy);   //设定X,Y坐标位置 
 557   1              LCD_CmdWrite(MWCR);
 558   1              while(*text != '\0')          
 559   1              {
 560   2                      LCD_DataWrite(*text++);
 561   2              }
 562   1      }
 563          
 564          /***************************************************************************/
 565          // 液晶在指定的坐标处显示字符
 566          // 参数：x坐标  y坐标  字符
 567          // 返回值：无
 568          /***************************************************************************/
 569          void LCD_ShowChar(uchar xxx,uchar yyy,uchar text)
 570          { 
 571   1              LCD_Text();   //选择文本模式
 572   1              LCD_GotoXY(xxx,yyy);   //设定X,Y坐标位置 
 573   1              LCD_CmdWrite(MWCR);
 574   1              LCD_DataWrite(text);
 575   1      }
 576          
 577          /***************************************************************************/
 578          // 液晶显示中文字库和字符
 579          // 参数：
 580          // 返回值：无
 581          /***************************************************************************/
 582          /*
 583          void display_word(const uchar *cha, int count )
 584          {
 585                  uint iiii=0;
 586                  LCD_Text();  //选择文本模式
 587                  LCD_GotoXY(0x00,0x00);   //设定X,Y坐标位置 
 588                  LCD_CmdWrite(MWCR); 
 589                  for(iiii=0;iiii<count;iiii++)
 590                  {
 591                          LCD_DataWrite(*cha++);
 592                  }   
 593          }
 594          */
 595          /***************************************************************************/
 596          // 显示一行边框
 597          // 参数：x起始坐标0~39  y起始坐标0~239  宽度  高度 颜色1正常2反白  
 598          // 返回值：无
 599          /***************************************************************************/
 600          void display_kuang(uchar x_star,uchar y_star,uchar w,uchar h, uchar color)
 601          {
 602   1              uchar width,heigh;      //i表示行,j表示列
 603   1              LCD_Graphic();   //选择绘图模式
 604   1              for(heigh=0;heigh<h;heigh++)
 605   1              {  
 606   2                      if(heigh==0)
 607   2                      {
 608   3                              LCD_GotoXY(x_star,y_star+heigh);   //设定X,Y开始坐标位置  
 609   3                              for(width=0;width<w;width++)
 610   3                              { 
 611   4                                      LCD_CmdWrite(MWCR); 
 612   4                                      LCD_DataWrite(0xff);
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 11  

 613   4                              }
 614   3                      }
 615   2                      else if((heigh>0)&&(heigh<(h-1)))
 616   2                      {
 617   3                              LCD_GotoXY(x_star,y_star+heigh);   //设定X,Y开始坐标位置    
 618   3                              LCD_CmdWrite(MWCR);   
 619   3                              if(color)
 620   3                              {
 621   4                                      LCD_DataWrite(0x80);
 622   4                                      for(width=1;width<(w-1);width++)
 623   4                                      {
 624   5                                              LCD_DataWrite(0x00);
 625   5                                      }
 626   4                                      LCD_DataWrite(0x01);
 627   4                              }
 628   3                              else
 629   3                              {
 630   4                                      LCD_DataWrite(0xff);
 631   4                                      for(width=1;width<(w-1);width++)
 632   4                                      {
 633   5                                              LCD_DataWrite(0xff);
 634   5                                      }
 635   4                                      LCD_DataWrite(0xff);                            
 636   4                              }
 637   3                      }
 638   2                      else if(heigh==(h-1))
 639   2                      {
 640   3                              LCD_GotoXY(x_star,y_star+heigh);   //设定X,Y开始坐标位置  
 641   3                              for(width=0;width<w;width++)
 642   3                              {      
 643   4                                      LCD_CmdWrite(MWCR);
 644   4                                      LCD_DataWrite(0xff);
 645   4                              }
 646   3                      }
 647   2              }
 648   1      }       
 649          
 650          /***************************************************************************/
 651          // 显示图片
 652          // 参数：x_star:0~39;y_star:0~239 w:0~39;h:0~239 
 653          // 返回值：无
 654          /***************************************************************************/
 655          void drow_picture(uchar x, uchar y, uchar w, uchar h, uchar *pData)
 656          {
 657   1              uchar i, j;
 658   1              LCD_Graphic(); 
 659   1              for(i=0;i<h;i++)
 660   1              {
 661   2                      for(j=0; j<w; j++)
 662   2                      {
 663   3                              LCD_GotoXY(x+j,y+i); 
 664   3                              LCD_CmdWrite(MWCR);   
 665   3                              LCD_DataWrite(*pData++); 
 666   3                      }
 667   2              }
 668   1      }
 669          
 670          /***************************************************************************/
 671          // 绘点函数
 672          // 参数：x坐标 y坐标
 673          // 返回值：无
 674          /***************************************************************************/
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 12  

 675          /*
 676          void drow_point(uint x, uint y)
 677          {
 678                  uchar temp, temp1= x/8;
 679                  LCD_Graphic();
 680                  LCD_GotoXY(temp1,y); 
 681                  LCD_CmdWrite(MRCR);     //内存读出 
 682                  temp = LCD_DataRead();
 683                  LCD_GotoXY(temp1,y); 
 684                  LCD_CmdWrite(MWCR);   
 685                  LCD_DataWrite(temp | (1<<7-x%8)); 
 686          }
 687          */
 688          
 689          /***************************************************************************/
 690          // 绘横线函数
 691          // 参数：x起始坐标 y起始坐标 x终止坐标
 692          // 返回值：无
 693          /***************************************************************************/
 694          /*
 695          void drow_row_line(uint x0, uint y0, uint x1)
 696          {
 697                  uint temp;
 698                  if(x0>x1)
 699                  {
 700                          temp = x1;
 701                          x1 = x0;
 702                          x0 = temp;
 703                  }
 704                  while(x1>=x0)
 705                  {
 706                          drow_point(x0, y0);
 707                          x0++;
 708                  }
 709          }
 710          */
 711          
 712          /***************************************************************************/
 713          // 绘竖线函数
 714          // 参数：x起始坐标 y起始坐标 y终止坐标
 715          // 返回值：无
 716          /***************************************************************************/
 717          /*
 718          void drow_column_line(uint x0, uint y0, uint y1)
 719          {
 720                  uint temp;
 721                  if(y0>y1)
 722                  {
 723                          temp = y1;
 724                          y1 = y0;
 725                          y0 = temp;
 726                  }
 727                  do
 728                  {
 729                          drow_point(x0, y0);
 730                          y0++;
 731                  }
 732                  while(y1>=y0);
 733          }
 734          */
 735          
 736          /***************************************************************************/
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 13  

 737          // 绘制圆角矩形
 738          // 参数：x起始坐标 y起始坐标 宽度 高度 颜色1正常2反白
 739          // 返回值：无
 740          /***************************************************************************/
 741          void display_r_kuang(uchar x_star,uchar y_star,uchar w,uchar h,uchar color)
 742          {
 743   1              if(color)
 744   1              {
 745   2                      display_kuang(x_star,y_star,w,h,1);
 746   2                      drow_picture(x_star, y_star, 1, 8, RoundedTLB);
 747   2                      drow_picture(x_star,  y_star+h-8, 1, 8, RoundedBLB);
 748   2                      drow_picture(x_star+w-1, y_star, 1, 8, RoundedTRB);
 749   2                      drow_picture(x_star+w-1, y_star+h-8, 1, 8, RoundedBRB);
 750   2              }
 751   1              else
 752   1              {
 753   2                      display_kuang(x_star,y_star,w,h,0);
 754   2                      drow_picture(x_star, y_star, 1, 8, RoundedTLF);
 755   2                      drow_picture(x_star,  y_star+h-8, 1, 8, RoundedBLF);
 756   2                      drow_picture(x_star+w-1, y_star, 1, 8, RoundedTRF);
 757   2                      drow_picture(x_star+w-1, y_star+h-8, 1, 8, RoundedBRF);         
 758   2              }
 759   1      }
 760          
 761          /***************************************************************************/
 762          // 绘制左侧圆角矩形
 763          // 参数：x起始坐标 y起始坐标 宽度 高度 颜色1正常2反白
 764          // 返回值：无
 765          /***************************************************************************/
 766          /*
 767          void display_rl_kuang(uchar x_star,uchar y_star,uchar w,uchar h,uchar color)
 768          {
 769                  if(color)
 770                  {
 771                          display_kuang(x_star,y_star,w,h,1);
 772                          drow_picture(x_star, y_star, 1, 8, RoundedTLB);
 773                          drow_picture(x_star,  y_star+h-8, 1, 8, RoundedBLB);
 774                  }
 775                  else
 776                  {
 777                          display_kuang(x_star,y_star,w,h,0);
 778                          drow_picture(x_star, y_star, 1, 8, RoundedTLF);
 779                          drow_picture(x_star,  y_star+h-8, 1, 8, RoundedBLF);
 780                  }
 781          }
 782          */
 783          
 784          /***************************************************************************/
 785          // 绘制右侧圆角矩形
 786          // 参数：x起始坐标 y起始坐标 宽度 高度 颜色1正常2反白
 787          // 返回值：无
 788          /***************************************************************************/
 789          /*
 790          void display_rr_kuang(uchar x_star,uchar y_star,uchar w,uchar h,uchar color)
 791          {
 792                  if(color)
 793                  {
 794                          display_kuang(x_star,y_star,w,h,1);
 795                          drow_picture(x_star+w-1, y_star, 1, 8, RoundedTRB);
 796                          drow_picture(x_star+w-1, y_star+h-8, 1, 8, RoundedBRB);
 797                  }
 798                  else
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 14  

 799                  {
 800                          display_kuang(x_star,y_star,w,h,0);
 801                          drow_picture(x_star+w-1, y_star, 1, 8, RoundedTRF);
 802                          drow_picture(x_star+w-1, y_star+h-8, 1, 8, RoundedBRF);         
 803                  }
 804          }
 805          */
 806          
 807          /***************************************************************************/
 808          // 允许触摸屏
 809          // 参数：无
 810          // 返回值：无
 811          /***************************************************************************/
 812          void Enable_TP(void)
 813          {
 814   1              uchar temp;
 815   1              temp=LCD_CmdRead(TPCR1);
 816   1              temp|=0x80;
 817   1              LCD_CmdWrite(TPCR1);
 818   1              LCD_DataWrite(temp);
 819   1      }
 820          
 821          /***************************************************************************/
 822          // 允许触摸屏非中断方式
 823          // 参数：无
 824          // 返回值：无
 825          /***************************************************************************/
 826          void Enable_Maunal_TP(void)
 827          {
 828   1              uchar temp;
 829   1              temp=LCD_CmdRead(TPCR2);
 830   1              temp|=0x80;
 831   1              LCD_CmdWrite(TPCR2);
 832   1              LCD_DataWrite(temp);
 833   1      }
 834          
 835          /***************************************************************************/
 836          // 允许触摸屏中断方式
 837          // 参数：无
 838          // 返回值：无
 839          /***************************************************************************/
 840          /*
 841          void Enable_interrput_TP(void)
 842          {
 843                  uchar temp;
 844                  temp=LCD_CmdRead(INTR);
 845                  temp|=0x10;
 846                  LCD_CmdWrite(INTR);
 847                  LCD_DataWrite(temp);
 848          }
 849          */
 850          
 851          /***************************************************************************/
 852          // 禁用触摸屏中断
 853          // 参数：无
 854          // 返回值：无
 855          /***************************************************************************/
 856          /*
 857          void Disable_interrput_TP(void)
 858          {
 859                  uchar temp;
 860                  temp=LCD_CmdRead(INTR);
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 15  

 861                  temp&=0xef;
 862                  LCD_CmdWrite(INTR);
 863                  LCD_DataWrite(temp);
 864          }
 865          */
 866          
 867          /***************************************************************************/
 868          // 
 869          // 参数：无
 870          // 返回值：无
 871          /***************************************************************************/
 872          void Switch_Latch_X_data(void)
 873          {
 874   1              uchar temp;
 875   1              temp=LCD_CmdRead(TPCR2);
 876   1              temp&=0xFE;
 877   1              temp|=0x02;
 878   1              LCD_CmdWrite(TPCR2);
 879   1              LCD_DataWrite(temp);
 880   1      }
 881          
 882          /***************************************************************************/
 883          // 
 884          // 参数：无
 885          // 返回值：无
 886          /***************************************************************************/
 887          void Switch_Latch_Y_data(void)
 888          {
 889   1              uchar temp;
 890   1              temp=LCD_CmdRead(TPCR2);
 891   1              temp|=0x01;
 892   1              temp|=0x02;
 893   1              LCD_CmdWrite(TPCR2);
 894   1              LCD_DataWrite(temp);
 895   1      }
 896          
 897          /***************************************************************************/
 898          // x坐标值转换
 899          // 参数：无
 900          // 返回值：无
 901          /***************************************************************************/
 902          uint trans_tpx(uint x)
 903          {
 904   1              long tp_x;
 905   1              long temp;
 906   1              temp=(((long)x)-x_tps0)*320;
 907   1              tp_x=temp/x_tps;
 908   1              return tp_x;
 909   1      }
 910          
 911          /***************************************************************************/
 912          // y坐标值转换
 913          // 参数：无
 914          // 返回值：无
 915          /***************************************************************************/
 916          uint trans_tpy(uint y)
 917          {
 918   1              long tp_y;
 919   1              long temp;
 920   1              temp=(((long)y)-y_tps0)*240;
 921   1              tp_y=temp/y_tps;
 922   1              return tp_y;
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 16  

 923   1      }
 924          
 925          /***************************************************************************/
 926          // 获取触摸屏值
 927          // 参数：触摸x坐标 触摸y坐标
 928          // 返回值：result_data
 929          //                                              0无触摸 
 930          //                                              1主界面定时设置 
 931          //                                              2主界面手自动 
 932          //                                              3主界面下班按键 
 933          //                                              4主界面关机状态取消下班 
 934          //                                              5设置界面一号槽选中  
 935          //                                              6设置界面二号槽选中 
 936          //                                              7设置界面三号槽选中 
 937          //                                              8设置界面四号槽选中  
 938          //                                              9设置界面五号槽选中  
 939          //                                              10设置界面六号槽选中
 940          //                                              11设置界面加一分钟
 941          //                                              12设置界面减一分钟
 942          //                                              13设置界面保存
 943          //                                              14设置界面返回
 944          //                                              15设置取消界面返回
 945          /***************************************************************************/
 946          uchar getTP_Value(uint x_temp, uint y_temp)
 947          {
 948   1              uchar result_data = 0;
 949   1              if(displayMode == MainDisplayMode) //主界面正常显示
 950   1              {
 951   2                      if(x_temp>0 && x_temp<96 && y_temp>208 && y_temp<240) //定时设置
 952   2                      {
 953   3                              if(runMode == ManualMode)
 954   3                              {
 955   4                                      result_data = 1;
 956   4                              }
 957   3                      }
 958   2                      else if(x_temp>104 && x_temp<208 && y_temp>208 && y_temp<240) //手自动
 959   2                      {
 960   3                              result_data = 2;
 961   3                      }
 962   2                      else if(x_temp>216 && x_temp<312 && y_temp>208 && y_temp<240) //下班按键
 963   2                      {
 964   3                              if(runMode == AutoMode) //只有自动模式下面才能点击下班按钮
 965   3                              {
 966   4                                      result_data = 3;
 967   4                              }
 968   3                      }
 969   2              }
 970   1              else if(displayMode == PowerOffing) //主界面正在关机
 971   1              {
 972   2                      if(x_temp>216 && x_temp<312 && y_temp>208 && y_temp<240) //取消下班
 973   2                      {
 974   3                              result_data = 4;
 975   3                      }
 976   2              }
 977   1              else if(displayMode == Setting) //设置界面正常显示
 978   1              {
 979   2                      if(x_temp>40 && x_temp<72 && y_temp>74 && y_temp<174) //一号槽选中 
 980   2                      {
 981   3                              result_data = 5;
 982   3                      }
 983   2                      else if(x_temp>80 && x_temp<112 && y_temp>74 && y_temp<174) //二号槽选中 
 984   2                      {
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 17  

 985   3                              result_data = 6;
 986   3                      }
 987   2                      else if(x_temp>120 && x_temp<152 && y_temp>74 && y_temp<174) //三号槽选中 
 988   2                      {
 989   3                              result_data = 7;
 990   3                      }
 991   2                      else if(x_temp>160 && x_temp<192 && y_temp>74 && y_temp<174) //四号槽选中  
 992   2                      {
 993   3                              result_data = 8;
 994   3                      }
 995   2                      else if(x_temp>200 && x_temp<232 && y_temp>74 && y_temp<174) //五号槽选中  
 996   2                      {
 997   3                              result_data = 9;
 998   3                      }
 999   2                      else if(x_temp>240 && x_temp<272 && y_temp>74 && y_temp<174) //六号槽选中
1000   2                      {
1001   3                              result_data = 10;
1002   3                      }
1003   2                      else if(x_temp>160 && x_temp<216 && y_temp>12 && y_temp<60) //加一分钟
1004   2                      {
1005   3                              result_data = 11;
1006   3                      }
1007   2                      else if(x_temp>232 && x_temp<288 && y_temp>12 && y_temp<60) //减一分钟
1008   2                      {
1009   3                              result_data = 12;
1010   3                      }
1011   2                      else if(x_temp>112 && x_temp<208 && y_temp>208 && y_temp<240) //保存
1012   2                      {
1013   3                              result_data = 13;
1014   3                      }
1015   2                      else if(x_temp>216 && x_temp<312 && y_temp>208 && y_temp<240) //返回
1016   2                      {
1017   3                              result_data = 14;
1018   3                      }
1019   2              }
1020   1              else if(displayMode == SettingSaved)//设置保存成功
1021   1              {
1022   2                      if(x_temp>216 && x_temp<312 && y_temp>208 && y_temp<240) //返回
1023   2                      {
1024   3                              result_data = 15;
1025   3                      }
1026   2              }
1027   1              return result_data;
1028   1      }
1029          
1030          /***************************************************************************/
1031          // 手动模式轮询测试触摸屏
1032          // 参数：无
1033          // 返回值：result_data 
1034          /***************************************************************************/
1035          uchar tp_ManualMode()
1036          {
1037   1              uchar Touch_Sta_Valid,INT_Sta,count,X1,Y1,X2,Y2,temp,result_data=0;
1038   1              uint X,Y,x_temp,y_temp;
1039   1              Touch_Sta_Valid=0;
1040   1              LCD_CmdWrite(TPCR2);
1041   1              LCD_DataWrite(0x81);
1042   1              LCD_CmdWrite(0xff); 
1043   1              LCD_DataWrite(0xff);  //写这段语句的意思是利用写数据时的判忙来确定此时ra8806是否处于内部工作状态
1044   1              INT_Sta=LCD_CmdRead(INTR);
1045   1              if((INT_Sta&0x08)==0x08)
1046   1              {
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 18  

1047   2                      for(count=0;count<50;count++)
1048   2                      {
1049   3                              INT_Sta=LCD_CmdRead(INTR);
1050   3                              if(INT_Sta==0)
1051   3                              {
1052   4                                      Touch_Sta_Valid=0;
1053   4                                      break;
1054   4                              }
1055   3                              if(count==49)
1056   3                              {
1057   4                                      Touch_Sta_Valid=1;
1058   4                              }
1059   3                      }
1060   2                      if(Touch_Sta_Valid)
1061   2                      {
1062   3                              Switch_Latch_X_data();
1063   3                              delay_us(100);
1064   3                              Switch_Latch_Y_data();  
1065   3                              delay_us(100);
1066   3                              X1=LCD_CmdRead(TPXR);
1067   3                              LCD_CmdWrite(0xff); 
1068   3                              LCD_DataWrite(0xff);
1069   3                              Y1=LCD_CmdRead(TPYR);
1070   3                              LCD_CmdWrite(0xff); 
1071   3                              LCD_DataWrite(0xff);
1072   3                              X2=LCD_CmdRead(TPZR)&0x03;
1073   3                              LCD_CmdWrite(0xff); 
1074   3                              LCD_DataWrite(0xff);
1075   3                              Y2=LCD_CmdRead(TPZR)&0x0c;
1076   3                              LCD_CmdWrite(0xff); 
1077   3                              LCD_DataWrite(0xff);
1078   3                              X = (((unsigned int)X1&0x00ff)<<2) | ((unsigned int)X2&0x0003);
1079   3                              Y = (((unsigned int)Y1&0x00ff)<<2) | (((unsigned int)Y2&0x000C) >> 2);
1080   3                              if((X<948)&&(X>94)&&(Y<944)&&(Y>92))
1081   3                              {
1082   4                                      x_temp=trans_tpx(X);
1083   4                                      y_temp=trans_tpy(Y);
1084   4                                      result_data = getTP_Value(x_temp, y_temp);
1085   4                              }
1086   3                      }
1087   2                      temp=LCD_CmdRead(INTR)&0xfe;
1088   2                      LCD_CmdWrite(INTR);
1089   2                      LCD_DataWrite(temp);
1090   2              }
1091   1              return result_data;
1092   1      }
1093          
1094          /***************************************************************************/
1095          // 显示设置界面
1096          // 参数：0正常设置  1保存成功提示  2保存失败提示 3正在保存提示
1097          // 返回值：无
1098          /***************************************************************************/
1099          void SettingDisplay(uchar settingStatus)
1100          {       
1101   1              uchar i, currentTimeCount;
1102   1              Access_Page2(); //存取DDRAM2
1103   1              clear(); 
1104   1              //加减时间按钮
1105   1              display_r_kuang(20,12,7,48,1);
1106   1              display_r_kuang(29,12,7,48,1);
1107   1              //设置槽框
1108   1              for(i=0; i<8; i++)
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 19  

1109   1              {
1110   2                      if(cistern[i].isCurrentlSetting)
1111   2                      {
1112   3                              display_kuang(i*5,74,4,100,0);
1113   3                      }
1114   2                      else
1115   2                      {
1116   3                              display_kuang(i*5,74,4,100,1);
1117   3                      }
1118   2              }
1119   1              //按建
1120   1              if(displayMode == Setting)
1121   1              {
1122   2                      display_r_kuang(14,208,12,32,1);
1123   2              }
1124   1              display_r_kuang(27,208,12,32,1);
1125   1              //提示框
1126   1              if(settingStatus)
1127   1              {
1128   2                      display_r_kuang(9,72,22,64,1);  //保存成功提示
1129   2              }
1130   1      
1131   1              Access_Page1(); //存取DDRAM1
1132   1              clear();
1133   1              normal_data();
1134   1              LCD_NoInv();
1135   1              //标题
1136   1              LCD_ShowStr(1,8,"定时设置:");
1137   1              //加减时间按钮
1138   1              LCD_ShowStr(21,18,"加 一");
1139   1              LCD_ShowStr(21,38,"分 钟");
1140   1              LCD_ShowStr(30,18,"减 一");
1141   1              LCD_ShowStr(30,38,"分 钟");
1142   1              //设置槽框
1143   1              LCD_ShowStr(1,96,"未");
1144   1              LCD_ShowStr(1,116,"设");
1145   1              LCD_ShowStr(1,136,"置");
1146   1              //设置槽框
1147   1              for(i=1; i<7; i++)
1148   1              {
1149   2                      currentTimeCount = cistern[i].perSettingTime/60;
1150   2                      LCD_ShowChar(1+5*i,96,currentTimeCount/10+48);
1151   2                      LCD_ShowChar(2+5*i,96,currentTimeCount%10+48);
1152   2                      LCD_ShowStr(1+5*i,116,"分");
1153   2                      LCD_ShowStr(1+5*i,136,"钟");
1154   2              }
1155   1              LCD_ShowStr(36,96,"未");
1156   1              LCD_ShowStr(36,116,"设");
1157   1              LCD_ShowStr(36,136,"置");
1158   1              //槽号
1159   1              LCD_ShowStr(1,180,"进");
1160   1              LCD_ShowStr(6,180,"1");
1161   1              LCD_ShowStr(11,180,"2");
1162   1              LCD_ShowStr(16,180,"3");
1163   1              LCD_ShowStr(21,180,"4");
1164   1              LCD_ShowStr(26,180,"5");
1165   1              LCD_ShowStr(31,180,"6");
1166   1              LCD_ShowStr(36,180,"出");
1167   1              //按建
1168   1              if(displayMode == Setting)
1169   1              {
1170   2                      LCD_ShowStr(17,216,"保  存");
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 20  

1171   2              }
1172   1              LCD_ShowStr(30,216,"返  回");
1173   1              //提示
1174   1              if(settingStatus)
1175   1              {
1176   2                      display_r_kuang(9,72,22,64,0);  //保存成功提示
1177   2                      display_kuang(10,80,20,48,1);   //保存成功提示
1178   2                      if(settingStatus == 1)
1179   2                              LCD_ShowStr(14,96,"保 存 成 功");   //保存成功提示
1180   2                      else if(settingStatus == 2)
1181   2                              LCD_ShowStr(14,96,"保 存 失 败");   //保存失败提示
1182   2                      else
1183   2                              LCD_ShowStr(14,96,"保 存 中...");   //保存失败提示
1184   2              }
1185   1      
1186   1              XOR_Two_Layer();//DDRAM1 OR DDRAM2
1187   1              Show_Two_Layer();//DDRAM1与DDRAM2同时显示
1188   1      }
1189          
1190          /***************************************************************************/
1191          // 开机界面
1192          // 参数：无
1193          // 返回值：无
1194          /***************************************************************************/
1195          void PowerOnDisplay()
1196          {
1197   1              Access_Page2();
1198   1              LCD_NoInv();
1199   1              clear();
1200   1              Access_Page1();
1201   1              LCD_NoInv();
1202   1              clear();
1203   1              Only_Show_Page1();
1204   1              //enlarge(2);
1205   1              //LCD_ShowStr(0x02,0x00,"慈溪星越纺机配件厂");
1206   1              enlarge(1);
1207   1              LCD_ShowStr(0x04,0x35,"联系人:陆志东");
1208   1              LCD_ShowStr(0x04,0x53,"联系电话: 13567402367");
1209   1      }
1210          
1211          /***************************************************************************/
1212          // 显示主界面
1213          // 参数：0正常显示 1正在关机 2关机成功
1214          // 返回值：无
1215          /***************************************************************************/
1216          void MainDisplay(uchar displayStatus)
1217          {
1218   1              uchar i, currentTimeCount;
1219   1              Access_Page2(); //存取DDRAM2
1220   1              clear(); 
1221   1              //状态显示
1222   1              display_kuang(0,0,8, 32, 1);
1223   1              display_kuang(8,0,8, 32, 1);
1224   1              //机械臂位置显示
1225   1              for(i=0; i<8; i++)
1226   1              {
1227   2                      drow_picture(2+i*5, 42, 1, 8, HollowPrism);     
1228   2                      drow_picture(2+i*5, 58, 1, 8, HollowPrism);     
1229   2              }
1230   1              if(manipulator.currentPosition%2 == 0)
1231   1              {
1232   2                      if(manipulator.manipulatorPosition == Top)
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 21  

1233   2                      {
1234   3                              drow_picture(2+manipulator.currentPosition/2*5, 42, 1, 8, SolidPrism);
1235   3                      }
1236   2                      else if(manipulator.manipulatorPosition == Bottom)
1237   2                      {
1238   3                              drow_picture(2+manipulator.currentPosition/2*5, 58, 1, 8, SolidPrism);  
1239   3                      }
1240   2              }
1241   1              else
1242   1              {
1243   2                      if(manipulator.manipulatorPosition == Top)
1244   2                      {
1245   3                              drow_picture(4+manipulator.currentPosition/2*5, 42, 1, 8, SolidPrism);
1246   3                      }
1247   2                      else if(manipulator.manipulatorPosition == Bottom)
1248   2                      {
1249   3                              drow_picture(4+manipulator.currentPosition/2*5, 58, 1, 8, SolidPrism);  
1250   3                      }
1251   2              }
1252   1              //槽状态显示
1253   1              for(i=0; i<8; i++)
1254   1              {
1255   2                      if(cistern[i].cisternStatus)
1256   2                      {
1257   3                              display_kuang(5*i,74,4,100,0);  
1258   3                      }
1259   2                      else
1260   2                      {
1261   3                              display_kuang(5*i,74,4,100,1);
1262   3                      }
1263   2              }
1264   1              //按键显示
1265   1              if(displayStatus == 0)
1266   1              {
1267   2                      if(runMode == ManualMode)
1268   2                      {
1269   3                              display_r_kuang(0,208,12,32,1); 
1270   3                      }
1271   2                      display_r_kuang(13,208,13,32,1);
1272   2              }
1273   1              if(runMode == AutoMode && displayStatus != 2) //只有自动模式下面才能点击下班按钮
1274   1              {
1275   2                      display_r_kuang(27,208,12,32,1);
1276   2              }
1277   1              
1278   1              //提示信息
1279   1              if(displayStatus)
1280   1              {
1281   2                      display_r_kuang(9,72,22,64,1);
1282   2              }
1283   1      
1284   1              Access_Page1();//存取DDRAM1
1285   1              clear();
1286   1              normal_data();
1287   1              LCD_NoInv();
1288   1              //状态显示
1289   1              LCD_ShowStr(2,8,"状态");
1290   1              if(runMode == AutoMode)
1291   1                      LCD_ShowStr(10,8,"自动");
1292   1              else
1293   1                      LCD_ShowStr(10,8,"手动");
1294   1      
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 22  

1295   1              //机械臂动作显示
1296   1              LCD_ShowStr(22,8,"机械臂动作:");
1297   1              switch(manipulator.manipulaterStatus)
1298   1              {
1299   2                      case Stop:
1300   2                              LCD_ShowStr(34,8,"空闲");
1301   2                      break;
1302   2                      case GoEntrance:
1303   2                              LCD_ShowStr(34,8,"<---");
1304   2                      break;
1305   2                      case GoOutfall:
1306   2                              LCD_ShowStr(34,8,"--->");
1307   2                      break;
1308   2                      case GoUp:
1309   2                              LCD_ShowStr(34,8,"向上");
1310   2                      break;
1311   2                      case GoDown:
1312   2                              LCD_ShowStr(34,8,"向下");
1313   2                      break;
1314   2                      default:
1315   2                              LCD_ShowStr(34,8,"错误");
1316   2              }
1317   1              //槽状态显示
1318   1              for(i=0; i<8; i++)
1319   1              {
1320   2                      if(cistern[i].cisternStatus == Empty)
1321   2                      {
1322   3                              LCD_ShowStr(1+5*i,100,"空");
1323   3                              LCD_ShowStr(1+5*i,132,"闲");
1324   3                      }
1325   2                      else if(cistern[i].cisternStatus == Ready)
1326   2                      {
1327   3                              LCD_ShowStr(1+5*i,100,"就");
1328   3                              LCD_ShowStr(1+5*i,132,"绪");
1329   3                      }
1330   2                      else
1331   2                      {       
1332   3                              if(i != 0 && i != 7)// 进口出口不安时间就绪
1333   3                              {
1334   4                                      currentTimeCount = (cistern[i].settingTime - cistern[i].currentTime)/60;
1335   4                                      LCD_ShowChar(1+5*i,96,currentTimeCount/10+48);
1336   4                                      LCD_ShowChar(2+5*i,96,currentTimeCount%10+48);
1337   4                                      LCD_ShowStr(1+5*i,116,"分");
1338   4                                      LCD_ShowStr(1+5*i,136,"钟");    
1339   4                              }
1340   3                              else
1341   3                              {
1342   4                                      LCD_ShowStr(1+5*i,100,"忙");
1343   4                                      LCD_ShowStr(1+5*i,132,"碌");
1344   4                              }               
1345   3                      }
1346   2              }
1347   1              LCD_ShowStr(1,180,"进");
1348   1              LCD_ShowStr(6,180,"1");
1349   1              LCD_ShowStr(11,180,"2");
1350   1              LCD_ShowStr(16,180,"3");
1351   1              LCD_ShowStr(21,180,"4");
1352   1              LCD_ShowStr(26,180,"5");
1353   1              LCD_ShowStr(31,180,"6");
1354   1              LCD_ShowStr(36,180,"出");
1355   1              //按键显示
1356   1              if(displayStatus == 0)
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 23  

1357   1              {
1358   2                      if(runMode == ManualMode)
1359   2                      {
1360   3                              LCD_ShowStr(2,216,"定时设置");
1361   3                      }
1362   2                      LCD_ShowStr(15,216,"手动/自动");
1363   2              }
1364   1              if(displayStatus == 1)
1365   1              {
1366   2                      LCD_ShowStr(29,216,"取消下班");
1367   2              }
1368   1              else if(displayStatus == 0 && runMode == AutoMode)//只有自动模式下面才能点击下班按钮
1369   1              {
1370   2                      LCD_ShowStr(29,216,"下班按键");
1371   2              }
1372   1              //提示信息
1373   1              if(displayStatus)
1374   1              {
1375   2                      display_r_kuang(9,72,22,64,0);
1376   2                      display_kuang(10,80,20,48,1);
1377   2                      if(displayStatus == 1)
1378   2                              LCD_ShowStr(14,96,"关 机 中...");
1379   2                      else
1380   2                              LCD_ShowStr(14,96,"关 机 成 功"); 
1381   2              }
1382   1      
1383   1              XOR_Two_Layer();//DDRAM1 OR DDRAM2
1384   1              Show_Two_Layer();//DDRAM1与DDRAM2同时显示
1385   1      }
1386          
1387          /***************************************************************************/
1388          // 机械臂状态刷新
1389          // 参数：无
1390          // 返回值：无
1391          /**************************************************************************/
1392          void ManipulatorStatusDisplay(void)
1393          {
1394   1              Access_Page1();//存取DDRAM1
1395   1              normal_data();
1396   1              LCD_NoInv();
1397   1              //机械臂动作显示
1398   1              switch(manipulator.manipulaterStatus)
1399   1              {
1400   2                      case Stop:
1401   2                              LCD_ShowStr(34,8,"空闲");
1402   2                      break;
1403   2                      case GoEntrance:
1404   2                              LCD_ShowStr(34,8,"<---");
1405   2                      break;
1406   2                      case GoOutfall:
1407   2                              LCD_ShowStr(34,8,"--->");
1408   2                      break;
1409   2                      case GoUp:
1410   2                              LCD_ShowStr(34,8,"向上");
1411   2                      break;
1412   2                      case GoDown:
1413   2                              LCD_ShowStr(34,8,"向下");
1414   2                      break;
1415   2                      default:
1416   2                              LCD_ShowStr(34,8,"错误");
1417   2              }
1418   1      }
C51 COMPILER V7.50   RA8806                                                                05/08/2014 20:40:11 PAGE 24  

1419          
1420          /***************************************************************************/
1421          // 触摸按钮反显函数
1422          // 参数：触摸值
1423          // 返回值：无
1424          /***************************************************************************/
1425          void TP_Response(uchar tpValue)
1426          {
1427   1              Access_Page2(); //存取DDRAM2    
1428   1              switch(tpValue)
1429   1              {
1430   2                      case 1:
1431   2                              display_r_kuang(0,208,12,32,0); 
1432   2                      break;
1433   2                      case 2:
1434   2                              display_r_kuang(13,208,13,32,0);
1435   2                      break;
1436   2                      case 3:
1437   2                              display_r_kuang(27,208,12,32,0);
1438   2                      break;
1439   2                      case 4:
1440   2                              display_r_kuang(27,208,12,32,0);
1441   2                      break;
1442   2                      case 11:
1443   2                              display_r_kuang(20,12,7,48,0);
1444   2                      break;
1445   2                      case 12:
1446   2                              display_r_kuang(29,12,7,48,0);
1447   2                      break;
1448   2                      case 13:
1449   2                              display_r_kuang(14,208,12,32,0);
1450   2                      break;
1451   2                      case 14:
1452   2                              display_r_kuang(27,208,12,32,0);
1453   2                      break;
1454   2                      case 15:
1455   2                              display_r_kuang(27,208,12,32,0);
1456   2                      break;
1457   2              }
1458   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4473    ----
   CONSTANT SIZE    =    764    ----
   XDATA SIZE       =   ----      32
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
